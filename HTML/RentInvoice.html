<!doctype html>
<html lang="en">

<head>
    <title>Rent Invoice Page</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <link rel="stylesheet" href="../CSS/Main.css">
    <link rel="stylesheet" href="//assets.cms.gov/resources/libs/datepicker/v6/css/datepicker.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.0/css/font-awesome.css"
        integrity="sha512-72McA95q/YhjwmWFMGe8RI3aZIMCTJWPBbV8iQY3jy1z9+bi6+jHnERuNrDPo/WGYEzzNs4WdHNyyEr/yXJ9pA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
    <header>
        <nav class="navbar navbar-expand-md navbar-light">
            <div class="container-fluid">
                <!-- Logo -->
                <img src="https://site202118.tw.cs.unibo.it/img/logo.eda7be37.png" alt="Logo" class="logo">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <!-- List of page -->
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                        <!-- Home -->
                        <li class="nav-item">
                            <a class="nav-link" href="Home.html">Home</a>
                        </li>
                        <!-- User -->
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="dropdownUsers" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">
                                Users
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="dropdownUsers">
                                <li><a class="dropdown-item" href="User.html">Create</a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="UserSearch.html">Search, Modify & Delete</a></li>
                            </ul>
                        </li>
                        <!-- Item -->
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="dropdownItems" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">
                                Items
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="dropdownItems">
                                <li><a class="dropdown-item" href="Item.html">Create</a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="ItemSearch.html">Search, Modify & Delete</a></li>
                            </ul>
                        </li>
                        <!-- Rent -->
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle active" aria-current="page" href="#" id="dropdownRent"
                                role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                Rent
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="dropdownRent">
                                <li><a class="dropdown-item" href="RentCreate.html">Create a Rent</a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="RentSearch.html">Search & Operate</a></li>
                            </ul>
                        </li>
                        <!-- Category -->
                        <li class="nav-item">
                            <a class="nav-link" href="Category.html">Categories</a>
                        </li>
                        <!-- Logout -->
                        <li class="nav-item">
                            <a class="nav-link" href="Login.html">Logout</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <div class="container">
        <div class="row">
            <div class="createForm offset-2 col-8">
                <h2 class="mb-4 text-center">Invoice of the rent</h2>
                <div class="row">
                    <!-- Customer -->
                    <div class="row">
                        <h4 id="customerRent">
                            <span class="active">Customer:</span>
                        </h4>
                        <h4 id="employeeRent">
                            <span class="active">Employee:</span>
                        </h4>
                    </div>
                    <div class="row">
                        <div class="">
                            <h4 id='startRent'><span class="active">Start date:</span></h4>
                            <h4 id='endRent'><span class="active">End date:</span></h4>
                        </div>
                    </div>
                </div>
                <!-- Items & Condition -->
                <div id='itemsContainer' class="my-4 py-4">
                    <h4><span class="active">Item/s:</span></h4>
                </div>
                <!-- Price -->
                <h4 id="priceContainer">
                    <span class="active">Price:</span>
                </h4>
            </div>
        </div>
    </div>
    <footer class="footer">
        <div class="container p-5">
            <div class="row">
                <div class="col-md-6">
                    <ul>
                        <li><a href="Home.html">Home</a></li>
                        <li><a href="https://site202118.tw.cs.unibo.it/">Shop</a></li>
                        <li><a href="https://site202118.tw.cs.unibo.it/management-dashboard">Manager</a></li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <img src="https://site202118.tw.cs.unibo.it/img/logo.eda7be37.png" class="img-fluid"
                        alt="Company Logo">
                </div>
            </div>
            <hr>
            <span class="small-text text-muted">Powered by NoloNolo+</span>
        </div>
    </footer>
    <script type="text/javascript" src="../JS/Main.js"></script>
    <script type="text/javascript" src="../JS/apiLibrary.js"></script>
    <!-- JQUERY -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        //authenticated?
        authBack()

        $(document).ready(async function () {
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            const id = urlParams.get('rent')
            let rent = await getRentByID(id)
            let invoice = await getInvoices({ productName: true, rent: id })
            let mapUser = await mapUserID()
            let mapEmployee = await mapEmployeeID()
            // Print of information about the rent
            $("#customerRent").append(mapUser[invoice[0].customer])
            $("#employeeRent").append(mapEmployee[invoice[0].employee])
            $("#startRent").append('' + invoice[0].start.split('T')[0] + '')
            $("#endRent").append('' + invoice[0].end.split('T')[0] + '')
            // Print of the items of the rent
            console.log(invoice[0].products.len)
            for (const item of rent.products) {
                await loadItem(item)
            }
            $("#priceContainer").append(invoice[0].price)
        })
        async function loadItem(item) {
            const fullItem = (await getItems({ _id: item }))[0]
            console.log(fullItem)
            const select = `<h5>${fullItem.name}, Condition: ${fullItem.condition} </h5>
              `
            $('#itemsContainer').append(select)
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj"
        crossorigin="anonymous"></script>
    <script type="text/javascript" src="//assets.cms.gov/resources/libs/datepicker/v6/js/datepicker.js"></script>
    <script type="text/javascript" src="//assets.cms.gov/resources/libs/datepicker/v6/js/datepicker.js"></script>
</body>

</html>